generator client {
  provider = "prisma-client-js"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model Video {
  id String @id @default(uuid())

  title       String
  description String

  channelId String

  status VideoStatus

  previewUrl String
  videoUrl   String

  likes          Like[]
  comment        Comment[]
  view           VideoView[]
  playlist_video PlaylistVideo[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([channelId])
  @@map("videos")
}

model Comment {
  id String @id @default(uuid())

  text String

  videoId String
  video   Video  @relation(fields: [videoId], references: [id])

  channelId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([videoId])
  @@map("comments")
}

model Like {
  id String @id @default(uuid())

  videoId String
  video   Video  @relation(fields: [videoId], references: [id])

  channelId String

  reaction ReactionValue

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([videoId, channelId])
  @@index([videoId])
  @@map("likes")
}

model VideoView {
  id String @id @default(uuid())

  videoId String
  video   Video  @relation(fields: [videoId], references: [id])

  channelId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([videoId, channelId])
  @@index([videoId])
  @@map("video_views")
}

model Playlist {
  id String @id @default(uuid())

  text      String
  channelId String

  playlistVideo PlaylistVideo[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("playlists")
}

model PlaylistVideo {
  id String @id @default(uuid())

  playlistId String
  playlist   Playlist @relation(fields: [playlistId], references: [id])

  videoId String
  video   Video  @relation(fields: [videoId], references: [id])

  position Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([playlistId, position])
  @@index([playlistId, position])
  @@map("playlist_videos")
}

enum ReactionValue {
  LIKE
  DISLIKE
}

enum VideoStatus {
  LIMITED
  PUBLIC
}
