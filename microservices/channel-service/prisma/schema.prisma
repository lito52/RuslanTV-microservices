generator client {
  provider = "prisma-client-js"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model Channel {
  id     String @id @default(uuid())
  userId String @unique
  name   String
  handle String @unique
  bio    String

  profilePicture    String
  backgroundPicture String

  posts         Post[]
  subscriptions Subscriptions[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("channels")
}

model Subscriptions {
  id String @id @default(uuid())

  userId String

  channel   Channel @relation(fields: [channelId], references: [id])
  channelId String

  subscribeType SubscribeType @default(REGULAR)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, channelId])
  @@index([userId])
  @@index([channelId])
  @@map("subscriptions")
}

model Post {
  id String @id @default(uuid())

  text String

  postLikes    PostLikes[]
  postComments PostComments[]
  postMedias   PostMedia[]

  channelId String
  channel   Channel @relation(fields: [channelId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([channelId])
  @@map("posts")
}

model PostMedia {
  id String @id @default(uuid())

  url String

  postId String
  post   Post   @relation(fields: [postId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@map("postMedias")
}

model PostLikes {
  id String @id @default(uuid())

  postId String
  post   Post   @relation(fields: [postId], references: [id])

  parentId String

  reaction ReactionValue

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([postId, parentId])
  @@map("post_likes")
}

model PostComments {
  id String @id @default(uuid())

  postId String
  post   Post   @relation(fields: [postId], references: [id])

  parentId String

  text String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("post_comments")
}

enum ReactionValue {
  LIKE
  DISLIKE
}

enum SubscribeType {
  REGULAR
  NOTIFICATIONS
}
